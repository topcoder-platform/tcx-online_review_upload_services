<?xml version="1.0"?>

<project name="Online Review Upload Services" default="dist" basedir=".">

    <property file="../topcoder_global.properties"/>

    <!-- COMPONENT PARAMETERS -->
    <property name="component" value="Online_Review_Upload_Services" />
    <property name="package" value="com.cronos.onlinereview.services.uploads" />
    <property name="packagedir" value="com/cronos/onlinereview/services/uploads" />
    <property name="distfilename" value="online_review_upload_services" />
    <property name="component_version" value="1.0" />
    <property name="component_path" value="${distfilename}/${component_version}" />

    <!-- DIRECTORY SETUP -->
    <property name="srcdir" value="src" />
    <property name="tcs" value="../tcs" />
    <property name="tcs_libdir" value="../tcs/lib/tcs" />
    <property name="ext_libdir" value="../tcs/lib/third_party" />
    <property name="jar_tcs_libdir" value="../tcs/lib/tcs" />
    <property name="jar_ext_libdir" value="../tcs/lib/third_party" />
    <property name="docsdir" value="docs" />
    <property name="configdir" value="conf" />
    <property name="testlogdir" value="log" />
    <property name="testfiles" value="test_files" />
    <property name="javadocsdir" value="${docsdir}/javadocs" />
    <property name="webdir" value="web" />
    <property name="reports" value="reports" />
    <property name="docs_coverage" value="${docsdir}/coverage" />

    <property name="javasrc" value="${srcdir}/java" />
    <property name="javamain" value="${javasrc}/main" />
    <property name="javatests" value="${javasrc}/tests" />

    <property name="builddir" value="build" />
    <property name="build_classdir" value="${builddir}/classes" />
    <property name="build_testclassdir" value="${builddir}/testClasses" />
    <property name="build_targetclassdir" value="${builddir}/targetclasses" />
    <property name="build_distdir" value="${builddir}/dist" />
    <property name="build_docsdir" value="${builddir}/${docsdir}" />
    <property name="build_javadocsdir" value="${builddir}/${javadocsdir}" />
    <property name="build_webdir" value="${builddir}/${webdir}" />
    <property name="build_lib" value="${builddir}/lib" />
    <property name="build_tcsdistdir" value="${build_distdir}/${distfilename}-${component_version}" />

    <!-- EXECUTION TAGS -->
    <property name="debug" value="off" />
    <property name="verbose" value="no" />

    <!-- COMPONENT DISTRIBUTION STRUCTURE -->
    <property name="dist_conf" value="${build_tcsdistdir}/${configdir}" />
    <property name="dist_lib" value="${build_distdir}/lib/tcs" />
    <property name="dist_src" value="${build_tcsdistdir}/${srcdir}" />
    <property name="dist_docs" value="${build_tcsdistdir}/${docsdir}" />
    <property name="dist_javadocs" value="${build_tcsdistdir}/${javadocsdir}" />
    <property name="dist_testfiles" value="${build_tcsdistdir}/${testfiles}" />
    <property name="dist_coverage" value="${dist_docs}/coverage" />

    <!-- NAME FOR .JAR AND .WAR FILES -->
    <property name="component.jar" value="${dist_lib}/${component_path}/${distfilename}.jar"/>
    <property name="javadoc.jar" value="javadocs.jar"/>
    <property name="component.tests.jar" value="${dist_lib}/${distfilename}_tests.jar"/>
    <property name="component.war" value="${dist_examples}/${distfilename}.war"/>
    <property name="component.dist.jar" value="${build_distdir}/${distfilename}-${component_version}.jar"/>
    <property name="dev_submission.jar" value="${component}_${component_version}_dev_submission.jar"/>
    <property name="design_submission.jar" value="${component}_${component_version}_design_submission.jar"/>
    <property name="dev_dist.jar" value="${component}_${component_version}_dev_dist.jar"/>
    <property name="design_dist.jar" value="${component}_${component_version}_design_dist.jar"/>

    <!-- DOCUMENT PACKAGE -->
    <property name="dist_docpackage" value="${builddir}/doc_package" />
    <property name="docpackage.jar" value="${distfilename}_docs.jar" />


    <property name="cobertura.dir" value="${ext_libdir}/cobertura/1.8"/>
    <path id="cobertura.classpath">
        <fileset dir="${cobertura.dir}">
            <include name="cobertura.jar"/>
            <include name="lib/**/*.jar"/>
        </fileset>
    </path>
    <taskdef classpathref="cobertura.classpath" resource="tasks.properties"/>
    <property name="cobertura.datafile" value="${testlogdir}/cobertura.ser"/>
    <property name="instrumented.dir" value="${builddir}/instrumented"/>

    <!-- TCS Dependencies -->
    <property name="auto_screening_management.version" value="1.0"/>
    <property name="auto_screening_management.jar.name" value="auto_screening_management.jar"/>
    <property name="auto_screening_management.path" value="auto_screening_management/${auto_screening_management.version}"/>
    <property name="auto_screening_management.jar" value="${tcs_libdir}/${auto_screening_management.path}/${auto_screening_management.jar.name}"/>

    <property name="base_exception.version" value="2.0"/>
    <property name="base_exception.jar.name" value="base_exception.jar"/>
    <property name="base_exception.path" value="base_exception/${base_exception.version}"/>
    <property name="base_exception.jar" value="${tcs_libdir}/${base_exception.path}/${base_exception.jar.name}"/>

    <property name="configuration_manager.version" value="2.1.5"/>
    <property name="configuration_manager.jar.name" value="configuration_manager.jar"/>
    <property name="configuration_manager.path" value="configuration_manager/${configuration_manager.version}"/>
    <property name="configuration_manager.jar" value="${tcs_libdir}/${configuration_manager.path}/${configuration_manager.jar.name}"/>

    <property name="database_abstraction.version" value="1.1"/>
    <property name="database_abstraction.jar.name" value="database_abstraction.jar"/>
    <property name="database_abstraction.path" value="database_abstraction/${database_abstraction.version}"/>
    <property name="database_abstraction.jar" value="${tcs_libdir}/${database_abstraction.path}/${database_abstraction.jar.name}"/>

    <property name="database_abstraction.version" value="1.1"/>
    <property name="database_abstraction.jar.name" value="database_abstraction.jar"/>
    <property name="database_abstraction.path" value="database_abstraction/${database_abstraction.version}"/>
    <property name="database_abstraction.jar" value="${tcs_libdir}/${database_abstraction.path}/${database_abstraction.jar.name}"/>

    <property name="database_abstraction.version" value="1.1"/>
    <property name="database_abstraction.jar.name" value="database_abstraction.jar"/>
    <property name="database_abstraction.path" value="database_abstraction/${database_abstraction.version}"/>
    <property name="database_abstraction.jar" value="${tcs_libdir}/${database_abstraction.path}/${database_abstraction.jar.name}"/>

    <property name="deliverable_management.version" value="1.0"/>
    <property name="deliverable_management.jar.name" value="deliverable_management.jar"/>
    <property name="deliverable_management.path" value="deliverable_management/${deliverable_management.version}"/>
    <property name="deliverable_management.jar" value="${tcs_libdir}/${deliverable_management.path}/${deliverable_management.jar.name}"/>

    <property name="guid_generator.version" value="1.0"/>
    <property name="guid_generator.jar.name" value="guid_generator.jar"/>
    <property name="guid_generator.path" value="guid_generator/${guid_generator.version}"/>
    <property name="guid_generator.jar" value="${tcs_libdir}/${guid_generator.path}/${guid_generator.jar.name}"/>

    <property name="logging_wrapper.version" value="2.0"/>
    <property name="logging_wrapper.jar.name" value="logging_wrapper.jar"/>
    <property name="logging_wrapper.path" value="logging_wrapper/${logging_wrapper.version}"/>
    <property name="logging_wrapper.jar" value="${tcs_libdir}/${logging_wrapper.path}/${logging_wrapper.jar.name}"/>

    <property name="object_factory.version" value="2.0.1"/>
    <property name="object_factory.jar.name" value="object_factory.jar"/>
    <property name="object_factory.path" value="object_factory/${object_factory.version}"/>
    <property name="object_factory.jar" value="${tcs_libdir}/${object_factory.path}/${object_factory.jar.name}"/>

    <property name="object_formatter.version" value="1.0"/>
    <property name="object_formatter.jar.name" value="object_formatter.jar"/>
    <property name="object_formatter.path" value="object_formatter/${object_formatter.version}"/>
    <property name="object_formatter.jar" value="${tcs_libdir}/${object_formatter.path}/${object_formatter.jar.name}"/>

    <property name="phase_management.version" value="1.0.2"/>
    <property name="phase_management.jar.name" value="phase_management.jar"/>
    <property name="phase_management.path" value="phase_management/${phase_management.version}"/>
    <property name="phase_management.jar" value="${tcs_libdir}/${phase_management.path}/${phase_management.jar.name}"/>

    <property name="project_management.version" value="1.0"/>
    <property name="project_management.jar.name" value="project_management.jar"/>
    <property name="project_management.path" value="project_management/${project_management.version}"/>
    <property name="project_management.jar" value="${tcs_libdir}/${project_management.path}/${project_management.jar.name}"/>

    <property name="project_phases.version" value="2.0"/>
    <property name="project_phases.jar.name" value="project_phases.jar"/>
    <property name="project_phases.path" value="project_phases/${project_phases.version}"/>
    <property name="project_phases.jar" value="${tcs_libdir}/${project_phases.path}/${project_phases.jar.name}"/>

    <property name="resource_management.version" value="1.1"/>
    <property name="resource_management.jar.name" value="resource_management.jar"/>
    <property name="resource_management.path" value="resource_management/${resource_management.version}"/>
    <property name="resource_management.jar" value="${tcs_libdir}/${resource_management.path}/${resource_management.jar.name}"/>

    <property name="search_builder.version" value="1.3.1"/>
    <property name="search_builder.jar.name" value="search_builder.jar"/>
    <property name="search_builder.path" value="search_builder/${search_builder.version}"/>
    <property name="search_builder.jar" value="${tcs_libdir}/${search_builder.path}/${search_builder.jar.name}"/>

    <property name="typesafe_enum.version" value="1.0"/>
    <property name="typesafe_enum.jar.name" value="typesafe_enum.jar"/>
    <property name="typesafe_enum.path" value="typesafe_enum/${typesafe_enum.version}"/>
    <property name="typesafe_enum.jar" value="${tcs_libdir}/${typesafe_enum.path}/${typesafe_enum.jar.name}"/>

    <property name="workdays.version" value="1.0"/>
    <property name="workdays.jar.name" value="workdays.jar"/>
    <property name="workdays.path" value="workdays/${workdays.version}"/>
    <property name="workdays.jar" value="${tcs_libdir}/${workdays.path}/${workdays.jar.name}"/>

    <!-- 3rd Party Dependencies  -->
    <property name="junit.jar" value="${ext_libdir}/junit/3.8.1/junit.jar"/>
    <property name="activation.jar" value="${ext_libdir}/jaf/1.2/activation.jar"/>
    <property name="axis.jar" value="${ext_libdir}/axis/1.4/axis.jar"/>
    <property name="commons-discovery.jar" value="${ext_libdir}/axis/1.4/lib/commons-discovery-0.2.jar"/>
    <property name="commons-logging.jar" value="${ext_libdir}/axis/1.4/lib/commons-logging-1.0.4.jar"/>
    <property name="jaxrpc.jar" value="${ext_libdir}/axis/1.4/lib/jaxrpc.jar"/>
    <property name="saaj.jar" value="${ext_libdir}/axis/1.4/lib/saaj.jar"/>
    <property name="wsdl4j.jar" value="${ext_libdir}/axis/1.4/lib/wsdl4j-1.5.1.jar"/>
    <property name="mailapi.jar" value="${ext_libdir}/javamail/1.4/mailapi.jar"/>


    <path id="buildlibs">
        <pathelement location="${auto_screening_management.jar}" />
        <pathelement location="${base_exception.jar}" />
        <pathelement location="${configuration_manager.jar}" />
        <pathelement location="${database_abstraction.jar}" />
        <pathelement location="${deliverable_management.jar}" />
        <pathelement location="${guid_generator.jar}" />
        <pathelement location="${logging_wrapper.jar}" />
        <pathelement location="${object_factory.jar}" />
        <pathelement location="${object_formatter.jar}" />
        <pathelement location="${phase_management.jar}" />
        <pathelement location="${project_management.jar}" />
        <pathelement location="${project_phases.jar}" />
        <pathelement location="${resource_management.jar}" />
        <pathelement location="${configuration_manager.jar}" />
        <pathelement location="${search_builder.jar}" />
        <pathelement location="${typesafe_enum.jar}" />
        <pathelement location="${workdays.jar}" />

        <pathelement location="${activation.jar}" />
        <pathelement location="${axis.jar}" />
        <pathelement location="${commons-discovery.jar}" />
        <pathelement location="${commons-logging.jar}" />
        <pathelement location="${jaxrpc.jar}" />
        <pathelement location="${saaj.jar}" />
        <pathelement location="${wsdl4j.jar}" />
        <pathelement location="${mailapi.jar}" />
    </path>

    <path id="test.build.classpath">
        <pathelement location="${build_testclassdir}"/>
        <pathelement location="${build_classdir}"/>
        <pathelement location="test_files"/>

        <path refid="buildlibs"/>
        <pathelement location="${junit.jar}" />        
    </path>



    <path id="runtime.classpath">
        <pathelement location="${build_classdir}"/>
        <path refid="buildlibs"/>
    </path>

    <taskdef resource="checkstyletask.properties"/>

    <target name="checkstyle" depends="compile">
        <mkdir dir="${testlogdir}"/>
        <checkstyle config="${ext_libdir}/tcs_checkstyle_config/tc_checks.xml" classpath="${ext_libdir}/tcs_checkstyle_config">
            <fileset dir="src/java/main" includes="**/*.java"/>
            <formatter type="plain" toFile="${testlogdir}/checkstyle.txt"/>
            <property key="basedir" value="${ext_libdir}/tcs_checkstyle_config"/>
        </checkstyle>
    </target>

    <target name="compile">
        <mkdir dir="${build_classdir}"/>
        <javac srcdir="${javamain}" destdir="${build_classdir}" includes="${packagedir}/**" debug="true"
               verbose="${verbose}">
            <classpath refid="buildlibs"/>
        </javac>
    </target>

    <target name="compile_tests" depends="compile">
        <mkdir dir="${build_testclassdir}"/>
        <javac srcdir="${javatests}" destdir="${build_testclassdir}" includes="${packagedir}/**" debug="true"
               verbose="${verbose}">
            <classpath refid="test.build.classpath"/>
        </javac>
    </target>

    <target name="test" depends="compile_tests">
        <mkdir dir="${testlogdir}"/>
        <mkdir dir="${instrumented.dir}"/>
        <delete file="${cobertura.datafile}" />
        <cobertura-instrument todir="${instrumented.dir}" datafile="${cobertura.datafile}">
            <!-- all included -->
            <fileset dir="${build_classdir}">
                <include name="**/*.class" />
            </fileset>
        </cobertura-instrument>
        <junit fork="true" haltonerror="false">
            <sysproperty key="net.sourceforge.cobertura.datafile" file="${cobertura.datafile}" />

            <classpath location="${instrumented.dir}" />
            <classpath location="${build_testclassdir}" />
            <classpath refid="test.build.classpath" />
            <classpath refid="cobertura.classpath" />

            <test name="${package}.AllTests" todir="${testlogdir}">
                <formatter type="plain" usefile="true"/>
                <formatter type="xml" usefile="true"/>
            </test>
        </junit>
    </target>

    <target name="coveragereport" depends="test">
        <cobertura-report format="html" destdir="${testlogdir}/coverage/" srcdir="${srcdir}" datafile="${cobertura.datafile}">
            <fileset dir="${javamain}">
                <include name="**/*.java" />
            </fileset>
            <fileset dir="${javatests}">
                <include name="**/*.java" />
            </fileset>
        </cobertura-report>
    </target>

    <target name="reports" depends="test">
        <mkdir dir="${reports}"/>

        <junitreport todir="${reports}">
          <fileset dir="${testlogdir}">
            <include name="*.xml"/>
          </fileset>
          <report format="frames" todir="${reports}"/>
        </junitreport>

        <echo>The execution of reports is complete.  Reports are available in /${reports}</echo>
    </target>

    <target name="dist" depends="compile">
        <mkdir dir="${dist_lib}/${component_path}"/>
        <jar jarfile="${component.jar}" basedir="${build_classdir}"/>
    </target>

    <target name="dist_tests" depends="compile_tests">
        <mkdir dir="${dist_lib}"/>
        <jar jarfile="${component.tests.jar}" basedir="${build_testclassdir}"/>
    </target>

    <target name="javadoc" depends="compile">
        <mkdir dir="${dist_javadocs}"/>
        <javadoc packagenames="${package}.*"
            sourcepath="${javamain}"
            classpath="${build_classdir}"
            classpathref="buildlibs"
            destdir="${dist_javadocs}"
            windowtitle="Topcoder Software"
            header="&lt;table border=0 cellpadding=0 cellspacing=2&gt;&lt;tr&gt;&lt;td&gt;&lt;font class=tcoder2&gt;&#091; &lt;/font&gt;&lt;font class=tcoder1&gt;TOP&lt;/font&gt;&lt;font class=tcoder2&gt;CODER &lt;/font&gt;&lt;font class=tcoder2&gt;&#093;&lt;/font&gt;&lt;/td&gt;&lt;td&gt;&lt;font class=tcoder4&gt;&#153;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=tcoder3 align=center&gt;&lt;font class=tcoder3&gt;SOFTWARE&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;"
            footer="&lt;table border=0 cellpadding=0 cellspacing=2&gt;&lt;tr&gt;&lt;td&gt;&lt;font class=tcoder2&gt;&#091; &lt;/font&gt;&lt;font class=tcoder1&gt;TOP&lt;/font&gt;&lt;font class=tcoder2&gt;CODER &lt;/font&gt;&lt;font class=tcoder2&gt;&#093;&lt;/font&gt;&lt;/td&gt;&lt;td&gt;&lt;font class=tcoder4&gt;&#153;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=tcoder3 align=center&gt;&lt;font class=tcoder3&gt;SOFTWARE&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;"
            bottom="&lt;font class=tcoder5&gt;Contact TopCoder Software at &lt;a href='http://www.topcodersoftware.com'&gt;www.topcodersoftware.com&lt;/a&gt;&lt;/font&gt;"
            stylesheetfile="${javadocsdir}/stylesheet.css"
            verbose="${verbose}">
            <tag name="copyright" description="Copyright:" scope="types"/>
        </javadoc>
    </target>

    <target name="clean">
        <delete dir="${builddir}"/>
    </target>

    <target name="deploy" depends="dist">
    </target>

    <target name="main" depends="deploy,test">
    </target>

</project>
